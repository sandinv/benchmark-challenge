FROM timescale/timescaledb:2.22.1-pg17

# Copy SQL schema file and CSV data file
COPY cpu_usage.sql /docker-entrypoint-initdb.d/01-schema.sql
COPY cpu_usage.csv /tmp/cpu_usage.csv

# Create init script to load CSV data after schema creation
RUN echo "#!/bin/bash\n\
set -e\n\
\n\
psql -v ON_ERROR_STOP=1 --username \"\$POSTGRES_USER\" --dbname \"homework\" <<-EOSQL\n\
    COPY cpu_usage FROM '/tmp/cpu_usage.csv' CSV HEADER;\n\
EOSQL\n\
" > /docker-entrypoint-initdb.d/02-load-data.sh && \
    chmod +x /docker-entrypoint-initdb.d/02-load-data.sh

# Set default password (can be overridden with environment variable)
ENV POSTGRES_PASSWORD=password


